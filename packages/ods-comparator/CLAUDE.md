# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Build Commands
```bash
# Build all packages in the monorepo
npm run build

# Clean build for all packages
npm run build:clean
```

### Testing Commands
```bash
# Run all tests (includes clean build, lint, and unit tests)
npm test

# Run ESLint
npm run test:lint:eslint

# Run TypeScript type checking
npm run test:lint:ts

# Run unit tests for ods-comparator (from root directory)
npm run test:unit:everything-else

# Run a specific test file
npx jest path/to/test/file.test.ts
```

### Development Commands
```bash
# TypeScript compilation check without emitting files
tsc -p . --noEmit
```

## Architecture

### Package Overview
The `@edfi/ods-comparator` package is a comparator between an ODS-API OpenAPI swagger.json file and a DMS ApiSchema.json file
generated by MetaEd-js, specifically the metaed-plugin-edfi-api-schema package. It's part of the larger MetaEd-js monorepo.

### Key Concepts

1. **ApiSchema Structure**: The src/api-schema directory contains comprehensive type system for a DMS ApiSchema.json file.
   - `apiSchemaVersion`: Semantic version for compatibility checking
   - `projectSchema`: The single project schema for this API
   - `resourceSchemas`: Each one starts with an API endpoint name
   - Each `ResourceSchema` (API endpoint) has semantic information about that endpoint's document that is similar to the information
     in an OpenAPI specification for an API endpoint's POST method. 
   - Within a `ResourceSchema` there is a `documentPathsMapping` that contains all of the possible JSONPaths in the body of
     the document for this API endpoint. These are found under `path` for non-references (`isReference: false`) and under
     the `referenceJsonPath` for array entries in `referenceJsonPaths` for references (`isReference: true`). `identityJsonPath`
     is not important and must be ignored.
   - Within a `ResourceSchema` there is also a `jsonSchemaForInsert` which is the JSON Schema definition for an API document
     POSTed to that API endpoint.


2. **Things to Ignore About ApiSchema**: There are portions of the ApiSchema that can be ignored for the purpose of this
   package. Underneath `projectSchema` you must ignore:
   - `abstractResources`
   - `caseInsensitiveEndpointNameMapping`
   - `compatibleDsRange`
   - `educationOrganizationHierarchy`
   - `educationOrganizationTypes`
   - `isExtensionProject`
   - `openApiCoreDescriptors`
   - `openApiCoreResources`
   - `resourceNameMapping`

   Underneath any specific `ResourceSchema`, for example `students`, you must ignore:
   - `arrayUniquenessConstraints`
   - `authorizationPathways`
   - `booleanJsonPaths`
   - `dateTimeJsonPaths`
   - `equalityConstraints`
   - `numericJsonPaths`
   - `queryFieldMapping`
   - `securableElements`

3. **Monorepo Context**: This package is part of a Lerna-managed monorepo where:
   - Common configuration is inherited from root `tsconfig.json`
   - Jest testing is configured at the root level
   - Build and test scripts are orchestrated through Lerna
   - This package is a standalone utility for validating the work of the metaed-plugin-edfi-api-schema package, which outputs an ApiSchema.json file.

4. **ApiSchema File**: The package contains a DMS ApiSchema.json file to be processed by the package called `ds-5.2-api-schema.json`

5. **OpenAPI File**: The package contains an ODS-API OpenAPI json file to be processed by the package called `ds-5.2-ods-api-openapi.json`.

### File Organization
- `/src/api-schema/`: Core type definitions and interfaces for API schema comparison
- Source files compile to `/dist/` directory
- Main entry point is `dist/index.js`

### Dependencies
The package depends on `@edfi/metaed-core` for shared types like `SemVer`.

### Code Style
Avoid the use of classes where simple functions in a module suffice. Use export to control visibility instead of private.
